{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Historical Financial Data Schemas",
  "description": "Comprehensive schemas for validating historical financial data storage",
  "definitions": {
    "metadata": {
      "type": "object",
      "properties": {
        "symbol": {
          "type": "string",
          "pattern": "^[A-Z0-9._-]+$",
          "description": "Stock symbol, sector, or identifier"
        },
        "data_type": {
          "type": "string",
          "enum": [
            "daily_prices", "financials", "fundamentals", "news_sentiment",
            "performance", "constituents", "analysis", "metrics",
            "indicators", "reports", "indices", "derivatives"
          ]
        },
        "timeframe": {
          "type": "string",
          "enum": ["daily", "weekly", "monthly", "quarterly", "yearly"]
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 formatted date"
        },
        "stored_at": {
          "type": "string",
          "format": "date-time"
        },
        "source": {
          "type": ["string", "null"],
          "description": "Data source identifier"
        },
        "data_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{32}$",
          "description": "MD5 hash for deduplication"
        }
      },
      "required": ["symbol", "data_type", "timeframe", "date", "stored_at", "data_hash"]
    }
  },
  "schemas": {
    "stock_daily_prices": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "symbol": {
              "type": "string",
              "pattern": "^[A-Z0-9._-]+$"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "open": {
              "type": "number",
              "minimum": 0,
              "description": "Opening price"
            },
            "high": {
              "type": "number",
              "minimum": 0,
              "description": "Highest price"
            },
            "low": {
              "type": "number",
              "minimum": 0,
              "description": "Lowest price"
            },
            "close": {
              "type": "number",
              "minimum": 0,
              "description": "Closing price"
            },
            "adjusted_close": {
              "type": ["number", "null"],
              "minimum": 0,
              "description": "Dividend-adjusted closing price"
            },
            "volume": {
              "type": "integer",
              "minimum": 0,
              "description": "Trading volume"
            },
            "currency": {
              "type": "string",
              "default": "USD",
              "description": "Currency of prices"
            }
          },
          "required": ["symbol", "date", "close"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "stock_financials": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "symbol": {
              "type": "string",
              "pattern": "^[A-Z0-9._-]+$"
            },
            "period": {
              "type": "string",
              "enum": ["Q1", "Q2", "Q3", "Q4", "annual"],
              "description": "Reporting period"
            },
            "fiscal_year": {
              "type": "integer",
              "minimum": 1900,
              "maximum": 2100
            },
            "currency": {
              "type": "string",
              "default": "USD"
            },
            "income_statement": {
              "type": ["object", "null"],
              "properties": {
                "revenue": {"type": ["number", "null"]},
                "gross_profit": {"type": ["number", "null"]},
                "operating_income": {"type": ["number", "null"]},
                "net_income": {"type": ["number", "null"]},
                "eps": {"type": ["number", "null"]},
                "shares_outstanding": {"type": ["number", "null"]}
              }
            },
            "balance_sheet": {
              "type": ["object", "null"],
              "properties": {
                "total_assets": {"type": ["number", "null"]},
                "total_liabilities": {"type": ["number", "null"]},
                "stockholders_equity": {"type": ["number", "null"]},
                "cash_and_cash_equivalents": {"type": ["number", "null"]},
                "total_debt": {"type": ["number", "null"]}
              }
            },
            "cash_flow": {
              "type": ["object", "null"],
              "properties": {
                "operating_cash_flow": {"type": ["number", "null"]},
                "investing_cash_flow": {"type": ["number", "null"]},
                "financing_cash_flow": {"type": ["number", "null"]},
                "free_cash_flow": {"type": ["number", "null"]}
              }
            }
          },
          "required": ["symbol", "fiscal_year"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "stock_fundamentals": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "symbol": {
              "type": "string",
              "pattern": "^[A-Z0-9._-]+$"
            },
            "company_name": {
              "type": "string"
            },
            "sector": {
              "type": "string"
            },
            "industry": {
              "type": "string"
            },
            "market_cap": {
              "type": ["number", "null"],
              "minimum": 0
            },
            "enterprise_value": {
              "type": ["number", "null"]
            },
            "pe_ratio": {
              "type": ["number", "null"],
              "minimum": 0
            },
            "pb_ratio": {
              "type": ["number", "null"],
              "minimum": 0
            },
            "dividend_yield": {
              "type": ["number", "null"],
              "minimum": 0,
              "maximum": 1
            },
            "beta": {
              "type": ["number", "null"]
            },
            "52_week_high": {
              "type": ["number", "null"],
              "minimum": 0
            },
            "52_week_low": {
              "type": ["number", "null"],
              "minimum": 0
            }
          },
          "required": ["symbol"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "stock_news_sentiment": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "symbol": {
              "type": "string",
              "pattern": "^[A-Z0-9._-]+$"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "news_items": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "title": {"type": "string"},
                  "summary": {"type": "string"},
                  "url": {"type": "string", "format": "uri"},
                  "source": {"type": "string"},
                  "published_at": {"type": "string", "format": "date-time"},
                  "sentiment_score": {
                    "type": "number",
                    "minimum": -1,
                    "maximum": 1
                  },
                  "sentiment_label": {
                    "type": "string",
                    "enum": ["positive", "negative", "neutral"]
                  }
                },
                "required": ["title", "source", "published_at"]
              }
            },
            "aggregate_sentiment": {
              "type": "object",
              "properties": {
                "average_score": {
                  "type": "number",
                  "minimum": -1,
                  "maximum": 1
                },
                "positive_count": {"type": "integer", "minimum": 0},
                "negative_count": {"type": "integer", "minimum": 0},
                "neutral_count": {"type": "integer", "minimum": 0},
                "total_articles": {"type": "integer", "minimum": 0}
              }
            }
          },
          "required": ["symbol", "date", "news_items"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "sector_performance": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "sector_name": {
              "type": "string"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "performance_metrics": {
              "type": "object",
              "properties": {
                "daily_return": {"type": ["number", "null"]},
                "weekly_return": {"type": ["number", "null"]},
                "monthly_return": {"type": ["number", "null"]},
                "ytd_return": {"type": ["number", "null"]},
                "one_year_return": {"type": ["number", "null"]},
                "volatility": {"type": ["number", "null"], "minimum": 0},
                "market_cap_weighted_price": {"type": ["number", "null"]}
              }
            },
            "top_performers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "symbol": {"type": "string"},
                  "return": {"type": "number"}
                }
              }
            },
            "bottom_performers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "symbol": {"type": "string"},
                  "return": {"type": "number"}
                }
              }
            }
          },
          "required": ["sector_name", "date", "performance_metrics"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "sector_constituents": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "sector_name": {
              "type": "string"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "constituents": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "symbol": {"type": "string"},
                  "company_name": {"type": "string"},
                  "market_cap": {"type": ["number", "null"]},
                  "weight": {"type": ["number", "null"], "minimum": 0, "maximum": 1},
                  "industry": {"type": "string"}
                },
                "required": ["symbol", "company_name"]
              }
            },
            "total_constituents": {
              "type": "integer",
              "minimum": 0
            },
            "total_market_cap": {
              "type": ["number", "null"],
              "minimum": 0
            }
          },
          "required": ["sector_name", "date", "constituents"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "economic_indicators": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "indicator_name": {
              "type": "string"
            },
            "indicator_code": {
              "type": "string"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "value": {
              "type": ["number", "string"]
            },
            "units": {
              "type": "string"
            },
            "frequency": {
              "type": "string",
              "enum": ["daily", "weekly", "monthly", "quarterly", "annual"]
            },
            "source": {
              "type": "string"
            },
            "revision_status": {
              "type": "string",
              "enum": ["preliminary", "revised", "final"]
            }
          },
          "required": ["indicator_name", "date", "value"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    },
    "market_indices": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/metadata"}
      ],
      "properties": {
        "data": {
          "type": "object",
          "properties": {
            "index_name": {
              "type": "string"
            },
            "index_symbol": {
              "type": "string"
            },
            "date": {
              "type": "string",
              "format": "date"
            },
            "open": {
              "type": "number",
              "minimum": 0
            },
            "high": {
              "type": "number",
              "minimum": 0
            },
            "low": {
              "type": "number",
              "minimum": 0
            },
            "close": {
              "type": "number",
              "minimum": 0
            },
            "volume": {
              "type": ["integer", "null"],
              "minimum": 0
            },
            "market_cap": {
              "type": ["number", "null"],
              "minimum": 0
            }
          },
          "required": ["index_name", "index_symbol", "date", "close"],
          "additionalProperties": true
        }
      },
      "required": ["data"]
    }
  },
  "validation_rules": {
    "price_data": {
      "description": "Rules for validating price data",
      "rules": [
        "High price must be >= Low price",
        "Open and Close prices must be between High and Low",
        "Volume must be non-negative",
        "Prices must be positive numbers"
      ]
    },
    "financial_data": {
      "description": "Rules for validating financial statements",
      "rules": [
        "Assets = Liabilities + Equity (balance sheet equation)",
        "EPS calculation should be consistent with net income and shares outstanding",
        "Fiscal year must be reasonable (1900-2100)"
      ]
    },
    "data_quality": {
      "description": "General data quality requirements",
      "rules": [
        "All required fields must be present",
        "Dates must be in valid ISO format",
        "Numeric values must be finite (not NaN or Infinity)",
        "Symbols must be uppercase alphanumeric"
      ]
    }
  },
  "metadata_schema": {
    "type": "object",
    "properties": {
      "created": {
        "type": "string",
        "format": "date-time"
      },
      "last_updated": {
        "type": "string",
        "format": "date-time"
      },
      "total_files": {
        "type": "integer",
        "minimum": 0
      },
      "data_types": {
        "type": "object",
        "patternProperties": {
          "^[a-z_]+$": {
            "type": "integer",
            "minimum": 0
          }
        }
      },
      "symbols": {
        "type": "object",
        "patternProperties": {
          "^[A-Z0-9._-]+$": {
            "type": "object",
            "properties": {
              "first_date": {"type": "string", "format": "date-time"},
              "last_date": {"type": "string", "format": "date-time"},
              "data_types": {
                "type": "array",
                "items": {"type": "string"}
              }
            },
            "required": ["first_date", "last_date", "data_types"]
          }
        }
      },
      "date_ranges": {
        "type": "object"
      }
    },
    "required": ["created", "last_updated", "total_files", "data_types", "symbols"]
  }
}
