{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sensylate.com/schemas/trade_history_discovery.json",
  "title": "Trade History Discovery Schema",
  "description": "JSON Schema for validating trade history discovery phase outputs from atomic discovery tool with unified calculation engine integration",
  "type": "object",
  "required": [
    "portfolio",
    "discovery_metadata",
    "portfolio_summary",
    "strategy_distribution",
    "ticker_performance",
    "performance_metrics",
    "active_positions",
    "data_quality_assessment",
    "local_data_integration"
  ],
  "additionalProperties": true,
  "properties": {
    "portfolio": {
      "type": "string",
      "description": "Portfolio identifier for trade history analysis"
    },
    "discovery_metadata": {
      "type": "object",
      "description": "Execution metadata from atomic discovery tool",
      "required": ["execution_timestamp", "confidence_score", "data_source"],
      "additionalProperties": true,
      "properties": {
        "execution_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of discovery execution"
        },
        "data_source": {
          "type": "string",
          "description": "Path to authoritative CSV data source"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 1.0,
          "description": "Overall discovery confidence including local data integration"
        },
        "data_completeness": {
          "type": "number",
          "minimum": 0.6,
          "maximum": 1.0,
          "description": "Data completeness from unified calculation engine"
        }
      }
    },
    "portfolio_summary": {
      "type": "object",
      "description": "Portfolio statistics from unified calculation engine",
      "required": ["total_trades", "closed_trades", "active_trades", "unique_tickers"],
      "additionalProperties": true,
      "properties": {
        "total_trades": {
          "type": "integer",
          "minimum": 1,
          "description": "Total number of trades in portfolio"
        },
        "closed_trades": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of closed/completed trades"
        },
        "active_trades": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of active/open trades"
        },
        "unique_tickers": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of unique ticker symbols"
        },
        "date_range": {
          "type": "object",
          "description": "Trading date range",
          "properties": {
            "earliest_entry": {
              "type": "string",
              "format": "date"
            },
            "latest_entry": {
              "type": "string",
              "format": "date"
            }
          }
        }
      }
    },
    "strategy_distribution": {
      "type": "object",
      "description": "Trading strategy distribution from unified calculation engine",
      "additionalProperties": {
        "type": "integer",
        "minimum": 0
      },
      "minProperties": 1
    },
    "ticker_performance": {
      "type": "object",
      "description": "Individual ticker performance from unified calculation engine",
      "patternProperties": {
        "^[A-Z]{1,5}$": {
          "type": "object",
          "required": ["total_trades", "total_return", "win_rate"],
          "additionalProperties": true,
          "properties": {
            "total_trades": {
              "type": "integer",
              "minimum": 1
            },
            "closed_trades": {
              "type": "integer",
              "minimum": 0
            },
            "active_trades": {
              "type": "integer",
              "minimum": 0
            },
            "total_return": {
              "type": "number",
              "description": "Cumulative return for ticker"
            },
            "win_rate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Win rate as decimal"
            },
            "wins": {
              "type": "integer",
              "minimum": 0
            },
            "losses": {
              "type": "integer",
              "minimum": 0
            },
            "avg_return": {
              "type": "number"
            }
          }
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    },
    "performance_metrics": {
      "type": "object",
      "description": "Core performance metrics from unified calculation engine",
      "required": ["win_rate", "total_wins", "total_losses", "profit_factor"],
      "additionalProperties": true,
      "properties": {
        "win_rate": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Overall win rate from closed trades"
        },
        "total_wins": {
          "type": "integer",
          "minimum": 0
        },
        "total_losses": {
          "type": "integer",
          "minimum": 0
        },
        "total_breakeven": {
          "type": "integer",
          "minimum": 0
        },
        "average_win_return": {
          "type": "number",
          "description": "Average winning trade return"
        },
        "average_loss_return": {
          "type": "number",
          "description": "Average losing trade return"
        },
        "profit_factor": {
          "type": "number",
          "minimum": 0,
          "description": "Profit factor metric"
        },
        "total_pnl": {
          "type": "number",
          "description": "Total profit and loss in base currency"
        },
        "total_return_percentage": {
          "type": "number",
          "description": "Total return as percentage"
        }
      }
    },
    "active_positions": {
      "type": "array",
      "description": "Current active positions from unified calculation engine",
      "items": {
        "type": "object",
        "required": ["ticker", "strategy"],
        "additionalProperties": true,
        "properties": {
          "ticker": {
            "type": "string",
            "pattern": "^[A-Z]{1,5}$"
          },
          "strategy": {
            "type": "string",
            "description": "Trading strategy used"
          },
          "days_held": {
            "type": "number",
            "minimum": 0,
            "description": "Position age in days"
          },
          "current_return": {
            "type": "number",
            "description": "Unrealized return for active position"
          },
          "entry_date": {
            "type": "string",
            "format": "date"
          }
        }
      }
    },
    "data_quality_assessment": {
      "type": "object",
      "description": "Data quality validation from unified calculation engine with local data integration",
      "required": ["overall_confidence"],
      "additionalProperties": true,
      "properties": {
        "overall_confidence": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 1.0,
          "description": "Overall data confidence score from unified engine with local data integration"
        },
        "fundamental_coverage_confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Fundamental analysis coverage confidence"
        }
      }
    },
    "local_data_integration": {
      "type": "object",
      "description": "Local fundamental analysis data integration and coverage assessment",
      "required": ["execution_timestamp", "total_tickers", "coverage_statistics"],
      "additionalProperties": true,
      "properties": {
        "execution_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "total_tickers": {
          "type": "integer",
          "minimum": 1
        },
        "fundamental_analysis_coverage": {
          "type": "object",
          "description": "Coverage details for each ticker",
          "patternProperties": {
            "^[A-Z]{1,5}$": {
              "type": "object",
              "required": ["file_path"],
              "properties": {
                "file_path": {
                  "type": "string"
                },
                "file_date": {
                  "type": ["string", "null"],
                  "format": "date-time"
                },
                "age_days": {
                  "type": ["integer", "null"],
                  "minimum": 0
                }
              }
            }
          }
        },
        "tickers_with_local_data": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[A-Z]{1,5}$"
          }
        },
        "coverage_statistics": {
          "type": "object",
          "required": ["fundamental_analysis_coverage", "tickers_with_analysis", "tickers_missing_analysis"],
          "properties": {
            "fundamental_analysis_coverage": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Fundamental analysis coverage ratio"
            },
            "tickers_with_analysis": {
              "type": "integer",
              "minimum": 0
            },
            "tickers_missing_analysis": {
              "type": "integer",
              "minimum": 0
            },
            "coverage_percentage": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 100.0
            }
          }
        }
      }
    }
  }
}
