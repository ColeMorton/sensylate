{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sensylate.com/schemas/trade_history_analysis.json",
  "title": "Trade History Analysis Schema",
  "description": "JSON Schema for validating trade history analysis phase outputs with institutional-grade trading validation standards",
  "type": "object",
  "required": [
    "portfolio",
    "analysis_metadata",
    "sample_validation",
    "signal_effectiveness",
    "statistical_analysis",
    "pattern_recognition",
    "optimization_opportunities",
    "risk_assessment",
    "analysis_quality_assessment",
    "next_phase_inputs"
  ],
  "additionalProperties": true,
  "properties": {
    "portfolio": {
      "type": "string",
      "const": "live_signals",
      "description": "Portfolio identifier for trade history analysis"
    },
    "analysis_metadata": {
      "type": "object",
      "description": "Trade analysis execution metadata and quality metrics",
      "required": ["execution_timestamp", "protocol_version", "confidence_score"],
      "additionalProperties": true,
      "properties": {
        "execution_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of analysis execution"
        },
        "protocol_version": {
          "type": "string",
          "enum": ["DASV_Phase_2_Statistical_Analysis"],
          "description": "Analysis protocol version identifier"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 1.0,
          "description": "Overall analysis confidence (institutional threshold: >0.8)"
        },
        "sample_size_adequacy": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Sample size adequacy assessment"
        },
        "statistical_significance": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Statistical significance level achieved"
        },
        "signal_effectiveness_confidence": {
          "type": "number",
          "minimum": 0.5,
          "maximum": 1.0,
          "description": "Confidence in signal effectiveness analysis"
        }
      }
    },
    "sample_validation": {
      "type": "object",
      "description": "Statistical sample validation and adequacy assessment",
      "required": ["total_trades", "closed_trades_analyzed", "minimum_sample_met"],
      "additionalProperties": true,
      "properties": {
        "total_trades": {
          "type": "integer",
          "minimum": 10,
          "description": "Total trades analyzed (institutional minimum: 10)"
        },
        "closed_trades_analyzed": {
          "type": "integer",
          "minimum": 5,
          "description": "Closed trades used for performance analysis (minimum: 5)"
        },
        "active_trades_portfolio": {
          "type": "integer",
          "minimum": 0,
          "maximum": 50,
          "description": "Current active trades in portfolio"
        },
        "minimum_sample_met": {
          "type": "boolean",
          "const": true,
          "description": "Must meet minimum sample requirements for institutional analysis"
        },
        "statistical_power": {
          "type": "number",
          "minimum": 0.8,
          "maximum": 1.0,
          "description": "Statistical power for hypothesis testing (institutional minimum: 0.8)"
        },
        "methodology_compliance": {
          "type": "string",
          "description": "Analysis methodology compliance note"
        }
      }
    },
    "signal_effectiveness": {
      "type": "object",
      "description": "Trading signal effectiveness analysis by strategy",
      "required": ["entry_signal_analysis"],
      "additionalProperties": true,
      "properties": {
        "entry_signal_analysis": {
          "type": "object",
          "description": "Entry signal performance analysis",
          "required": ["win_rate_by_strategy", "total_strategies_analyzed"],
          "properties": {
            "win_rate_by_strategy": {
              "type": "object",
              "description": "Win rate analysis by trading strategy",
              "properties": {
                "EMA": {
                  "type": "object",
                  "description": "Exponential Moving Average strategy performance",
                  "required": ["win_rate", "total_trades", "confidence"],
                  "properties": {
                    "win_rate": {
                      "type": "number",
                      "minimum": 0.0,
                      "maximum": 1.0,
                      "description": "Strategy win rate (institutional benchmark: >0.45)"
                    },
                    "total_trades": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Total trades executed with this strategy"
                    },
                    "winners": {
                      "type": "integer",
                      "minimum": 0,
                      "description": "Number of winning trades"
                    },
                    "losers": {
                      "type": "integer",
                      "minimum": 0,
                      "description": "Number of losing trades"
                    },
                    "average_return_winners": {
                      "type": "number",
                      "description": "Average return of winning trades"
                    },
                    "average_return_losers": {
                      "type": "number",
                      "description": "Average return of losing trades"
                    },
                    "sample_size_adequacy": {
                      "type": "boolean",
                      "description": "Whether sample size is adequate for statistical inference"
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0.5,
                      "maximum": 1.0,
                      "description": "Confidence in strategy performance analysis"
                    }
                  }
                },
                "SMA": {
                  "type": "object",
                  "description": "Simple Moving Average strategy performance",
                  "required": ["win_rate", "total_trades", "confidence"],
                  "properties": {
                    "win_rate": {
                      "type": "number",
                      "minimum": 0.0,
                      "maximum": 1.0,
                      "description": "Strategy win rate (institutional benchmark: >0.45)"
                    },
                    "total_trades": {
                      "type": "integer",
                      "minimum": 1,
                      "description": "Total trades executed with this strategy"
                    },
                    "winners": {
                      "type": "integer",
                      "minimum": 0,
                      "description": "Number of winning trades"
                    },
                    "losers": {
                      "type": "integer",
                      "minimum": 0,
                      "description": "Number of losing trades"
                    },
                    "average_return_winners": {
                      "type": "number",
                      "description": "Average return of winning trades"
                    },
                    "average_return_losers": {
                      "type": "number",
                      "description": "Average return of losing trades"
                    },
                    "sample_size_adequacy": {
                      "type": "boolean",
                      "description": "Whether sample size is adequate for statistical inference"
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0.5,
                      "maximum": 1.0,
                      "description": "Confidence in strategy performance analysis"
                    }
                  }
                }
              },
              "minProperties": 1
            },
            "total_strategies_analyzed": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5,
              "description": "Number of strategies included in analysis"
            },
            "strategies_excluded": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of strategies excluded due to insufficient data"
            }
          }
        },
        "exit_signal_analysis": {
          "type": "object",
          "description": "Exit signal effectiveness analysis",
          "properties": {
            "exit_efficiency_metrics": {
              "type": "object",
              "description": "Exit timing efficiency measurements",
              "required": ["sample_size", "confidence"],
              "properties": {
                "overall_exit_efficiency": {
                  "type": "number",
                  "description": "Overall exit timing efficiency metric"
                },
                "mfe_capture_rate": {
                  "type": "number",
                  "description": "Maximum Favorable Excursion capture rate"
                },
                "sample_size": {
                  "type": "integer",
                  "minimum": 5,
                  "description": "Number of trades analyzed for exit efficiency"
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0.8,
                  "maximum": 1.0,
                  "description": "Confidence in exit efficiency analysis"
                }
              }
            }
          }
        }
      }
    },
    "statistical_analysis": {
      "type": "object",
      "description": "Statistical analysis of trading performance",
      "required": ["statistical_analysis", "performance_metrics"],
      "additionalProperties": true,
      "properties": {
        "statistical_analysis": {
          "type": "object",
          "description": "Comprehensive statistical analysis of returns",
          "required": ["return_distribution", "statistical_significance", "risk_adjusted_metrics"],
          "properties": {
            "return_distribution": {
              "type": "object",
              "description": "Return distribution analysis",
              "required": ["sample_size", "confidence"],
              "properties": {
                "mean_return": {
                  "type": "number",
                  "description": "Mean return of all trades"
                },
                "median_return": {
                  "type": "number",
                  "description": "Median return of all trades"
                },
                "std_deviation": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Standard deviation of returns"
                },
                "skewness": {
                  "type": "number",
                  "description": "Skewness of return distribution"
                },
                "kurtosis": {
                  "type": "number",
                  "description": "Kurtosis of return distribution"
                },
                "normality_test_p_value": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "P-value from normality test"
                },
                "sample_size": {
                  "type": "integer",
                  "minimum": 10,
                  "description": "Sample size for distribution analysis"
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0.9,
                  "maximum": 1.0,
                  "description": "Confidence in distribution analysis"
                }
              }
            },
            "statistical_significance": {
              "type": "object",
              "description": "Statistical significance testing",
              "required": ["return_vs_zero"],
              "properties": {
                "return_vs_zero": {
                  "type": "object",
                  "description": "Test of returns vs zero hypothesis",
                  "required": ["t_statistic", "p_value", "significant_at_95"],
                  "properties": {
                    "t_statistic": {
                      "type": "number",
                      "description": "T-statistic for significance test"
                    },
                    "p_value": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "P-value of significance test"
                    },
                    "significant_at_95": {
                      "type": "boolean",
                      "description": "Whether returns are significant at 95% confidence"
                    },
                    "confidence_interval_95": {
                      "type": "array",
                      "items": {
                        "type": "number"
                      },
                      "minItems": 2,
                      "maxItems": 2,
                      "description": "95% confidence interval for mean return"
                    }
                  }
                }
              }
            },
            "risk_adjusted_metrics": {
              "type": "object",
              "description": "Risk-adjusted performance metrics",
              "required": ["sharpe_ratio", "confidence"],
              "properties": {
                "sharpe_ratio": {
                  "type": "number",
                  "description": "Sharpe ratio for risk-adjusted returns"
                },
                "sortino_ratio": {
                  "type": "number",
                  "description": "Sortino ratio focusing on downside risk"
                },
                "downside_deviation": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Downside deviation metric"
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0.8,
                  "maximum": 1.0,
                  "description": "Confidence in risk-adjusted metrics"
                }
              }
            }
          }
        },
        "performance_metrics": {
          "type": "object",
          "description": "Core trading performance metrics",
          "required": ["win_rate", "profit_factor", "sample_size", "confidence"],
          "properties": {
            "win_rate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "description": "Overall win rate (institutional benchmark: >0.45)"
            },
            "total_wins": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of winning trades"
            },
            "total_losses": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of losing trades"
            },
            "total_pnl": {
              "type": "number",
              "description": "Total profit and loss in base currency"
            },
            "profit_factor": {
              "type": "number",
              "minimum": 0.5,
              "description": "Profit factor (institutional threshold: >1.0)"
            },
            "expectancy": {
              "type": "number",
              "description": "Expected value per trade"
            },
            "sample_size": {
              "type": "integer",
              "minimum": 10,
              "description": "Sample size for performance calculation"
            },
            "confidence": {
              "type": "number",
              "minimum": 0.9,
              "maximum": 1.0,
              "description": "Confidence in performance metrics"
            }
          }
        }
      }
    },
    "performance_measurement": {
      "type": "object",
      "description": "Additional performance measurement data",
      "additionalProperties": true
    },
    "pattern_recognition": {
      "type": "object",
      "description": "Pattern recognition and trade quality analysis",
      "required": ["trade_quality_classification"],
      "additionalProperties": true,
      "properties": {
        "trade_quality_classification": {
          "type": "object",
          "description": "Classification of trades by quality categories",
          "patternProperties": {
            "^(Excellent|Good|Poor|Poor Setup - High Risk, Low Reward|Failed to Capture Upside)$": {
              "type": "object",
              "required": ["count", "percentage", "avg_return", "characteristics"],
              "properties": {
                "count": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of trades in this category"
                },
                "percentage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Percentage of total trades in this category"
                },
                "avg_return": {
                  "type": "number",
                  "description": "Average return for trades in this category"
                },
                "characteristics": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1,
                  "description": "Characteristic features of this trade category"
                }
              }
            }
          },
          "additionalProperties": false
        },
        "pattern_recognition": {
          "type": "object",
          "description": "Temporal and structural pattern analysis",
          "required": ["sample_size", "confidence"],
          "properties": {
            "signal_temporal_patterns": {
              "type": "object",
              "description": "Time-based signal effectiveness patterns",
              "properties": {
                "monthly_effectiveness": {
                  "type": "object",
                  "description": "Monthly performance breakdown",
                  "patternProperties": {
                    "^month_\\d+$": {
                      "type": "object",
                      "required": ["trade_count", "win_rate", "avg_return"],
                      "properties": {
                        "trade_count": {
                          "type": "integer",
                          "minimum": 1,
                          "description": "Number of trades in this month"
                        },
                        "win_rate": {
                          "type": "number",
                          "minimum": 0,
                          "maximum": 1,
                          "description": "Win rate for this month"
                        },
                        "avg_return": {
                          "type": "number",
                          "description": "Average return for this month"
                        }
                      }
                    }
                  }
                }
              }
            },
            "sample_size": {
              "type": "integer",
              "minimum": 10,
              "description": "Sample size for pattern analysis"
            },
            "confidence": {
              "type": "number",
              "minimum": 0.7,
              "maximum": 1.0,
              "description": "Confidence in pattern recognition results"
            }
          }
        }
      }
    },
    "optimization_opportunities": {
      "type": "object",
      "description": "Strategy optimization recommendations",
      "required": ["entry_signal_enhancements"],
      "additionalProperties": true,
      "properties": {
        "entry_signal_enhancements": {
          "type": "array",
          "description": "Entry signal improvement opportunities",
          "items": {
            "type": "object",
            "required": ["opportunity", "implementation", "confidence"],
            "properties": {
              "opportunity": {
                "type": "string",
                "description": "Description of optimization opportunity"
              },
              "current_win_rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Current win rate for this opportunity"
              },
              "potential_improvement": {
                "type": "string",
                "description": "Potential improvement description"
              },
              "implementation": {
                "type": "string",
                "description": "Implementation approach for this optimization"
              },
              "confidence": {
                "type": "number",
                "minimum": 0.5,
                "maximum": 1.0,
                "description": "Confidence in this optimization opportunity"
              }
            }
          },
          "minItems": 1
        },
        "exit_signal_refinements": {
          "type": "array",
          "description": "Exit signal improvement opportunities",
          "items": {
            "type": "object",
            "required": ["opportunity", "implementation", "confidence"],
            "properties": {
              "opportunity": {
                "type": "string",
                "description": "Description of exit optimization opportunity"
              },
              "current_efficiency": {
                "type": "number",
                "description": "Current exit efficiency metric"
              },
              "potential_improvement": {
                "type": "string",
                "description": "Potential improvement description"
              },
              "implementation": {
                "type": "string",
                "description": "Implementation approach for this optimization"
              },
              "confidence": {
                "type": "number",
                "minimum": 0.5,
                "maximum": 1.0,
                "description": "Confidence in this optimization opportunity"
              }
            }
          }
        },
        "strategy_parameter_optimization": {
          "type": "array",
          "description": "Strategy parameter optimization opportunities",
          "items": {
            "type": "object",
            "required": ["opportunity", "implementation", "confidence"],
            "properties": {
              "opportunity": {
                "type": "string",
                "description": "Description of parameter optimization opportunity"
              },
              "current_p_value": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Current statistical significance p-value"
              },
              "requirement": {
                "type": "string",
                "description": "Requirement for optimization"
              },
              "implementation": {
                "type": "string",
                "description": "Implementation approach for this optimization"
              },
              "confidence": {
                "type": "number",
                "minimum": 0.5,
                "maximum": 1.0,
                "description": "Confidence in this optimization opportunity"
              }
            }
          }
        }
      }
    },
    "risk_assessment": {
      "type": "object",
      "description": "Risk analysis and portfolio metrics",
      "required": ["drawdown_analysis"],
      "additionalProperties": true,
      "properties": {
        "drawdown_analysis": {
          "type": "object",
          "description": "Drawdown and risk analysis",
          "required": ["confidence"],
          "properties": {
            "max_drawdown": {
              "type": "number",
              "maximum": 0,
              "description": "Maximum drawdown experienced"
            },
            "avg_drawdown": {
              "type": "number",
              "maximum": 0,
              "description": "Average drawdown"
            },
            "downside_deviation": {
              "type": "number",
              "minimum": 0,
              "description": "Downside deviation metric"
            },
            "confidence": {
              "type": "number",
              "minimum": 0.8,
              "maximum": 1.0,
              "description": "Confidence in drawdown analysis"
            }
          }
        },
        "portfolio_risk_metrics": {
          "type": "object",
          "description": "Portfolio-level risk metrics",
          "required": ["confidence"],
          "properties": {
            "active_positions": {
              "type": "integer",
              "minimum": 0,
              "maximum": 50,
              "description": "Number of active positions"
            },
            "sector_concentration": {
              "type": "object",
              "description": "Sector concentration breakdown",
              "additionalProperties": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            },
            "position_diversification": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Position diversification metric"
            },
            "confidence": {
              "type": "number",
              "minimum": 0.7,
              "maximum": 1.0,
              "description": "Confidence in portfolio risk assessment"
            }
          }
        }
      }
    },
    "analysis_quality_assessment": {
      "type": "object",
      "description": "Analysis quality and confidence metrics",
      "required": ["overall_confidence", "methodology_compliance"],
      "additionalProperties": true,
      "properties": {
        "overall_confidence": {
          "type": "number",
          "minimum": 0.7,
          "maximum": 1.0,
          "description": "Overall analysis confidence (institutional threshold: >0.8)"
        },
        "sample_size_confidence": {
          "type": "number",
          "minimum": 0.8,
          "maximum": 1.0,
          "description": "Confidence in sample size adequacy"
        },
        "statistical_robustness": {
          "type": "number",
          "minimum": 0.3,
          "maximum": 1.0,
          "description": "Statistical robustness assessment"
        },
        "signal_analysis_confidence": {
          "type": "number",
          "minimum": 0.8,
          "maximum": 1.0,
          "description": "Confidence in signal analysis results"
        },
        "methodology_compliance": {
          "type": "boolean",
          "const": true,
          "description": "Compliance with institutional analysis methodology"
        },
        "conservative_scoring": {
          "type": "boolean",
          "description": "Whether conservative scoring approach was used"
        },
        "limitations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Known limitations of the analysis"
        }
      }
    },
    "next_phase_inputs": {
      "type": "object",
      "description": "Analysis readiness for next phase",
      "required": ["synthesis_ready", "analysis_package_path"],
      "additionalProperties": true,
      "properties": {
        "synthesis_ready": {
          "type": "boolean",
          "const": true,
          "description": "Whether analysis is ready for synthesis phase"
        },
        "confidence_threshold_met": {
          "type": "boolean",
          "description": "Whether institutional confidence threshold was met"
        },
        "analysis_package_path": {
          "type": "string",
          "description": "Path to complete analysis package"
        },
        "critical_findings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Critical findings from analysis"
        },
        "report_focus_areas": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "signal_effectiveness_optimization",
              "statistical_performance_validation", 
              "risk_management_enhancement",
              "strategy_parameter_tuning"
            ]
          },
          "minItems": 1,
          "description": "Recommended focus areas for reporting"
        }
      }
    }
  }
}