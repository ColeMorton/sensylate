{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Trading Validation Schema v1",
  "description": "Schema for trade_history_validate microservice output - comprehensive quality assurance and validation",
  "type": "object",
  "required": [
    "portfolio",
    "validation_metadata",
    "statistical_validation",
    "report_integrity",
    "business_logic_validation",
    "confidence_scoring",
    "overall_assessment",
    "quality_certification",
    "validation_summary"
  ],
  "properties": {
    "portfolio": {
      "type": "object",
      "required": ["name", "data_source", "validation_timestamp"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Portfolio identifier"
        },
        "data_source": {
          "type": "string",
          "description": "Source CSV file path"
        },
        "validation_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Validation execution timestamp"
        },
        "total_phases_validated": {
          "type": "number",
          "description": "Number of DASV phases validated (3)"
        }
      }
    },
    "validation_metadata": {
      "type": "object",
      "required": ["version", "validation_depth", "execution_time", "validation_engine"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Schema version"
        },
        "validation_depth": {
          "type": "string",
          "enum": ["basic", "standard", "comprehensive", "institutional"],
          "description": "Level of validation rigor applied"
        },
        "execution_time": {
          "type": "number",
          "description": "Validation duration in seconds"
        },
        "validation_engine": {
          "type": "object",
          "properties": {
            "statistical_module": {
              "type": "boolean",
              "description": "Statistical validation module executed"
            },
            "integrity_module": {
              "type": "boolean",
              "description": "Report integrity module executed"
            },
            "business_logic_module": {
              "type": "boolean",
              "description": "Business logic validation module executed"
            },
            "confidence_module": {
              "type": "boolean",
              "description": "Confidence scoring module executed"
            }
          }
        },
        "baseline_comparison": {
          "type": "boolean",
          "description": "Cross-validation against monolithic command performed"
        }
      }
    },
    "statistical_validation": {
      "type": "object",
      "required": ["calculation_accuracy", "significance_testing", "sample_adequacy", "distribution_analysis"],
      "properties": {
        "calculation_accuracy": {
          "type": "object",
          "properties": {
            "win_rate_validation": {
              "type": "object",
              "properties": {
                "calculated_value": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                },
                "cross_check_value": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                },
                "variance": {
                  "type": "number",
                  "description": "Absolute difference between calculations"
                },
                "tolerance_met": {
                  "type": "boolean",
                  "description": "Within ±0.5% acceptable variance"
                },
                "validation_confidence": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "sharpe_ratio_validation": {
              "type": "object",
              "properties": {
                "calculated_value": {
                  "type": "number"
                },
                "cross_check_value": {
                  "type": "number"
                },
                "variance": {
                  "type": "number"
                },
                "tolerance_met": {
                  "type": "boolean",
                  "description": "Within ±0.02 acceptable variance"
                },
                "component_verification": {
                  "type": "object",
                  "properties": {
                    "return_calculation": {
                      "type": "boolean"
                    },
                    "volatility_measurement": {
                      "type": "boolean"
                    },
                    "excess_return": {
                      "type": "boolean"
                    }
                  }
                }
              }
            },
            "drawdown_validation": {
              "type": "object",
              "properties": {
                "calculated_value": {
                  "type": "number"
                },
                "cross_check_value": {
                  "type": "number"
                },
                "variance": {
                  "type": "number"
                },
                "tolerance_met": {
                  "type": "boolean",
                  "description": "Within ±0.1% acceptable variance"
                },
                "duration_analysis": {
                  "type": "boolean",
                  "description": "Drawdown period calculations verified"
                }
              }
            }
          }
        },
        "significance_testing": {
          "type": "object",
          "properties": {
            "sample_size_assessment": {
              "type": "object",
              "properties": {
                "total_trades": {
                  "type": "number"
                },
                "minimum_threshold_met": {
                  "type": "boolean",
                  "description": "≥10 trades requirement"
                },
                "statistical_power": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Power analysis result"
                },
                "adequacy_score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "hypothesis_testing": {
              "type": "object",
              "properties": {
                "win_rate_significance": {
                  "type": "object",
                  "properties": {
                    "null_hypothesis": {
                      "type": "string",
                      "description": "Win rate = 50% (random performance)"
                    },
                    "p_value": {
                      "type": "number",
                      "minimum": 0.0,
                      "maximum": 1.0
                    },
                    "significance_level": {
                      "type": "number",
                      "description": "Alpha level (typically 0.05)"
                    },
                    "statistically_significant": {
                      "type": "boolean"
                    }
                  }
                },
                "return_significance": {
                  "type": "object",
                  "properties": {
                    "t_statistic": {
                      "type": "number"
                    },
                    "p_value": {
                      "type": "number"
                    },
                    "confidence_interval": {
                      "type": "array",
                      "items": {
                        "type": "number"
                      },
                      "minItems": 2,
                      "maxItems": 2
                    }
                  }
                }
              }
            }
          }
        },
        "sample_adequacy": {
          "type": "object",
          "properties": {
            "minimum_trades_check": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number",
                  "description": "Minimum required trades (10)"
                },
                "actual_count": {
                  "type": "number"
                },
                "threshold_met": {
                  "type": "boolean"
                },
                "confidence_impact": {
                  "type": "number",
                  "description": "Impact on overall confidence if below threshold"
                }
              }
            },
            "statistical_power_analysis": {
              "type": "object",
              "properties": {
                "alpha_level": {
                  "type": "number",
                  "description": "Type I error rate (0.05)"
                },
                "beta_level": {
                  "type": "number",
                  "description": "Type II error rate (0.20)"
                },
                "effect_size": {
                  "type": "number",
                  "description": "Minimum detectable effect"
                },
                "power": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            }
          }
        },
        "distribution_analysis": {
          "type": "object",
          "properties": {
            "normality_testing": {
              "type": "object",
              "properties": {
                "shapiro_wilk": {
                  "type": "object",
                  "properties": {
                    "statistic": {
                      "type": "number"
                    },
                    "p_value": {
                      "type": "number"
                    },
                    "normal_distribution": {
                      "type": "boolean"
                    }
                  }
                },
                "qq_plot_assessment": {
                  "type": "string",
                  "enum": ["excellent", "good", "poor", "failed"],
                  "description": "Visual distribution tail assessment"
                }
              }
            },
            "outlier_detection": {
              "type": "object",
              "properties": {
                "iqr_method": {
                  "type": "object",
                  "properties": {
                    "outliers_detected": {
                      "type": "number"
                    },
                    "outlier_percentage": {
                      "type": "number"
                    },
                    "impact_assessment": {
                      "type": "string",
                      "enum": ["minimal", "moderate", "significant", "severe"]
                    }
                  }
                },
                "z_score_analysis": {
                  "type": "object",
                  "properties": {
                    "extreme_outliers": {
                      "type": "number",
                      "description": "Returns > 3 standard deviations"
                    },
                    "statistical_impact": {
                      "type": "string",
                      "enum": ["negligible", "minor", "moderate", "major"]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "report_integrity": {
      "type": "object",
      "required": ["structural_completeness", "content_accuracy", "cross_report_consistency"],
      "properties": {
        "structural_completeness": {
          "type": "object",
          "properties": {
            "internal_report_validation": {
              "type": "object",
              "properties": {
                "executive_dashboard": {
                  "type": "boolean",
                  "description": "30-second brief presence and quality"
                },
                "critical_issues": {
                  "type": "boolean",
                  "description": "P1/P2/P3 prioritization present"
                },
                "optimization_roadmap": {
                  "type": "boolean",
                  "description": "Specific actions with confidence"
                },
                "section_count": {
                  "type": "number",
                  "description": "Required sections present (9)"
                },
                "completeness_score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "live_monitor_validation": {
              "type": "object",
              "properties": {
                "position_tracking": {
                  "type": "boolean",
                  "description": "All active positions included"
                },
                "market_context": {
                  "type": "boolean",
                  "description": "Current environment analysis"
                },
                "signal_strength": {
                  "type": "boolean",
                  "description": "Performance categorization"
                },
                "real_time_focus": {
                  "type": "boolean",
                  "description": "Current date relevance"
                },
                "completeness_score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "historical_report_validation": {
              "type": "object",
              "properties": {
                "trade_coverage": {
                  "type": "boolean",
                  "description": "All closed positions analyzed"
                },
                "quality_distribution": {
                  "type": "boolean",
                  "description": "Classification complete"
                },
                "temporal_patterns": {
                  "type": "boolean",
                  "description": "Monthly/seasonal analysis"
                },
                "learning_extraction": {
                  "type": "boolean",
                  "description": "Key insights present"
                },
                "completeness_score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            }
          }
        },
        "content_accuracy": {
          "type": "object",
          "properties": {
            "data_consistency_checks": {
              "type": "object",
              "properties": {
                "discovery_analysis_alignment": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Input-output data consistency"
                },
                "analysis_synthesis_alignment": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Analysis-report consistency"
                },
                "cross_report_consistency": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Metric consistency across reports"
                },
                "calculation_verification": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Computed values traceability"
                }
              }
            },
            "metric_validation": {
              "type": "object",
              "properties": {
                "percentage_formatting": {
                  "type": "boolean",
                  "description": "XX.XX% format consistency"
                },
                "currency_formatting": {
                  "type": "boolean",
                  "description": "${X,XXX.XX} format compliance"
                },
                "ratio_formatting": {
                  "type": "boolean",
                  "description": "X.XX format consistency"
                },
                "date_formatting": {
                  "type": "boolean",
                  "description": "Consistent date format"
                },
                "statistical_formatting": {
                  "type": "boolean",
                  "description": "XX.XX% ± X.X% format"
                }
              }
            }
          }
        },
        "cross_report_consistency": {
          "type": "object",
          "properties": {
            "metric_consistency": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "metric_name": {
                    "type": "string"
                  },
                  "internal_report_value": {
                    "type": "number"
                  },
                  "live_monitor_value": {
                    "type": "number"
                  },
                  "historical_report_value": {
                    "type": "number"
                  },
                  "consistency_score": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0
                  }
                }
              }
            },
            "trend_indicator_consistency": {
              "type": "object",
              "properties": {
                "improving_indicators": {
                  "type": "number",
                  "description": "Count of ↗️ indicators"
                },
                "stable_indicators": {
                  "type": "number",
                  "description": "Count of → indicators"
                },
                "deteriorating_indicators": {
                  "type": "number",
                  "description": "Count of ↘️ indicators"
                },
                "consistency_with_data": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            }
          }
        }
      }
    },
    "business_logic_validation": {
      "type": "object",
      "required": ["signal_effectiveness_coherence", "optimization_feasibility", "risk_assessment_validation"],
      "properties": {
        "signal_effectiveness_coherence": {
          "type": "object",
          "properties": {
            "entry_exit_consistency": {
              "type": "object",
              "properties": {
                "mfe_mae_relationship": {
                  "type": "boolean",
                  "description": "MFE ≥ |MAE| for profitable trades"
                },
                "exit_efficiency_bounds": {
                  "type": "boolean",
                  "description": "0.0 ≤ exit_efficiency ≤ 1.0"
                },
                "duration_reasonableness": {
                  "type": "boolean",
                  "description": "Hold periods within expected ranges"
                },
                "strategy_consistency": {
                  "type": "boolean",
                  "description": "SMA vs EMA classification accuracy"
                }
              }
            },
            "performance_attribution": {
              "type": "object",
              "properties": {
                "win_rate_profitability": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Win rate correlation with returns"
                },
                "sharpe_risk_relationship": {
                  "type": "boolean",
                  "description": "Higher Sharpe implies better risk-adjusted returns"
                },
                "drawdown_recovery": {
                  "type": "boolean",
                  "description": "Recovery periods reasonable"
                },
                "benchmark_correlation": {
                  "type": "number",
                  "minimum": -1.0,
                  "maximum": 1.0,
                  "description": "Alpha calculation accuracy"
                }
              }
            }
          }
        },
        "optimization_feasibility": {
          "type": "object",
          "properties": {
            "feasibility_assessment": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "optimization_area": {
                    "type": "string",
                    "enum": ["exit_efficiency", "duration_management", "strategy_allocation", "risk_management"]
                  },
                  "proposed_improvement": {
                    "type": "string"
                  },
                  "feasibility_score": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0
                  },
                  "implementation_confidence": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0
                  },
                  "timeline_realistic": {
                    "type": "boolean"
                  }
                }
              }
            },
            "impact_quantification": {
              "type": "object",
              "properties": {
                "dollar_impact_accuracy": {
                  "type": "boolean",
                  "description": "Opportunity cost calculations correct"
                },
                "percentage_improvement_validity": {
                  "type": "boolean",
                  "description": "Efficiency gains properly calculated"
                },
                "timeline_feasibility": {
                  "type": "boolean",
                  "description": "Implementation deadlines achievable"
                },
                "resource_assessment": {
                  "type": "boolean",
                  "description": "Complexity appropriately assessed"
                }
              }
            }
          }
        },
        "risk_assessment_validation": {
          "type": "object",
          "properties": {
            "portfolio_risk_coherence": {
              "type": "object",
              "properties": {
                "correlation_accuracy": {
                  "type": "boolean",
                  "description": "Position correlation calculations accurate"
                },
                "concentration_measurement": {
                  "type": "boolean",
                  "description": "Sector exposure properly measured"
                },
                "volatility_consistency": {
                  "type": "boolean",
                  "description": "Risk measures consistent with performance"
                },
                "diversification_scoring": {
                  "type": "boolean",
                  "description": "Diversification ratio verified"
                }
              }
            },
            "market_context_integration": {
              "type": "object",
              "properties": {
                "regime_classification": {
                  "type": "string",
                  "enum": ["bull_market", "bear_market", "sideways_market", "transitional"],
                  "description": "Current market regime"
                },
                "regime_accuracy": {
                  "type": "boolean",
                  "description": "Regime properly identified"
                },
                "volatility_environment": {
                  "type": "boolean",
                  "description": "VIX correlation accurate"
                },
                "benchmark_relevance": {
                  "type": "boolean",
                  "description": "SPY benchmark appropriate"
                }
              }
            }
          }
        }
      }
    },
    "confidence_scoring": {
      "type": "object",
      "required": ["component_confidence", "overall_confidence", "quality_classification"],
      "properties": {
        "component_confidence": {
          "type": "object",
          "properties": {
            "discovery_phase_confidence": {
              "type": "object",
              "properties": {
                "data_completeness": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.30"
                },
                "fundamental_integration": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.20"
                },
                "market_context_quality": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.25"
                },
                "portfolio_metadata": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.25"
                },
                "weighted_average": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "analysis_phase_confidence": {
              "type": "object",
              "properties": {
                "statistical_significance": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.35"
                },
                "calculation_accuracy": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.30"
                },
                "pattern_reliability": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.20"
                },
                "optimization_feasibility": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.15"
                },
                "weighted_average": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "synthesis_phase_confidence": {
              "type": "object",
              "properties": {
                "content_accuracy": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.40"
                },
                "template_compliance": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.25"
                },
                "audience_appropriateness": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.20"
                },
                "action_specificity": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Weight: 0.15"
                },
                "weighted_average": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            }
          }
        },
        "overall_confidence": {
          "type": "object",
          "properties": {
            "weighted_aggregation": {
              "type": "object",
              "properties": {
                "discovery_weight": {
                  "type": "number",
                  "description": "0.25"
                },
                "analysis_weight": {
                  "type": "number",
                  "description": "0.40"
                },
                "synthesis_weight": {
                  "type": "number",
                  "description": "0.35"
                },
                "overall_score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            },
            "threshold_assessment": {
              "type": "object",
              "properties": {
                "minimum_threshold": {
                  "type": "number",
                  "description": "Configured minimum (typically 0.7)"
                },
                "threshold_met": {
                  "type": "boolean"
                },
                "threshold_margin": {
                  "type": "number",
                  "description": "Distance from threshold"
                }
              }
            }
          }
        },
        "quality_classification": {
          "type": "object",
          "properties": {
            "confidence_band": {
              "type": "string",
              "enum": ["institutional_grade", "operational_grade", "standard_grade", "developmental_grade", "inadequate"],
              "description": "Quality classification based on confidence score"
            },
            "band_description": {
              "type": "string",
              "description": "Description of quality band characteristics"
            },
            "recommendations": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Quality improvement recommendations"
            }
          }
        }
      }
    },
    "overall_assessment": {
      "type": "object",
      "required": ["validation_success", "quality_gates", "critical_findings"],
      "properties": {
        "validation_success": {
          "type": "boolean",
          "description": "All validation checks passed successfully"
        },
        "quality_gates": {
          "type": "object",
          "properties": {
            "minimum_confidence": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number"
                },
                "actual": {
                  "type": "number"
                },
                "passed": {
                  "type": "boolean"
                }
              }
            },
            "statistical_accuracy": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number",
                  "description": "0.98 target"
                },
                "actual": {
                  "type": "number"
                },
                "passed": {
                  "type": "boolean"
                }
              }
            },
            "content_accuracy": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number",
                  "description": "0.99 target"
                },
                "actual": {
                  "type": "number"
                },
                "passed": {
                  "type": "boolean"
                }
              }
            },
            "business_logic_coherence": {
              "type": "object",
              "properties": {
                "threshold": {
                  "type": "number",
                  "description": "0.95 target"
                },
                "actual": {
                  "type": "number"
                },
                "passed": {
                  "type": "boolean"
                }
              }
            }
          }
        },
        "critical_findings": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "severity": {
                "type": "string",
                "enum": ["critical", "warning", "informational"]
              },
              "category": {
                "type": "string",
                "enum": ["statistical", "integrity", "business_logic", "confidence"]
              },
              "finding": {
                "type": "string",
                "description": "Description of the issue"
              },
              "impact": {
                "type": "string",
                "description": "Impact on overall quality"
              },
              "recommendation": {
                "type": "string",
                "description": "Suggested resolution"
              }
            }
          }
        }
      }
    },
    "quality_certification": {
      "type": "object",
      "required": ["certification_level", "approval_status", "limitations"],
      "properties": {
        "certification_level": {
          "type": "string",
          "enum": ["institutional", "operational", "standard", "developmental", "not_certified"],
          "description": "Quality certification level achieved"
        },
        "approval_status": {
          "type": "string",
          "enum": ["approved", "approved_with_conditions", "requires_improvement", "rejected"],
          "description": "Final approval determination"
        },
        "limitations": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Known limitations and caveats"
        },
        "valid_until": {
          "type": "string",
          "format": "date-time",
          "description": "Certification validity period"
        },
        "reviewer": {
          "type": "string",
          "description": "Validation specialist identifier"
        }
      }
    },
    "validation_summary": {
      "type": "object",
      "required": ["executive_summary", "key_metrics", "action_items"],
      "properties": {
        "executive_summary": {
          "type": "string",
          "description": "High-level validation results summary"
        },
        "key_metrics": {
          "type": "object",
          "properties": {
            "overall_confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "validation_accuracy": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "false_positive_rate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "false_negative_rate": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "critical_issues_count": {
              "type": "number"
            }
          }
        },
        "action_items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "priority": {
                "type": "string",
                "enum": ["immediate", "high", "medium", "low"]
              },
              "action": {
                "type": "string",
                "description": "Required action"
              },
              "deadline": {
                "type": "string",
                "description": "Completion timeline"
              },
              "owner": {
                "type": "string",
                "description": "Responsible party"
              }
            }
          }
        }
      }
    }
  }
}
